<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: presentation/components/movie-list.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: presentation/components/movie-list.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module presentation/components */
import React from 'react'
import { MovieItemComponent } from './movie-item'
import { deviceManager } from '../../manager/device-manager'
import orderListMap from '../../helpers/order-list-map'
import animateList from '../../helpers/animate-list'
import css from '../styles/movie-list.scss'

export class MovieListComponent extends React.Component {
    /**
     * Initialize the MovieListComponent 
     * @param {React.Props} props - The component props
     */
    constructor(props) {
        super(props)

        this.onKeyOk = this.onKeyOk.bind(this)
        this.onKeyLeft = this.onKeyLeft.bind(this)
        this.onKeyRight = this.onKeyRight.bind(this)
        this.onClickArrowLeft = this.onClickArrowLeft.bind(this)
        this.onClickArrowRight = this.onClickArrowRight.bind(this)
        this.onMouseEnterMovieItem = this.onMouseEnterMovieItem.bind(this)
        this.onMouseEnterArrows = this.onMouseEnterArrows.bind(this)
        this.onMouseLeaveArrows = this.onMouseLeaveArrows.bind(this)
        this.onMouseMove = this.onMouseMove.bind(this)
        this.onMovieItemMount = this.onMovieItemMount.bind(this)
        this.setMovieItemFocus = this.setMovieItemFocus.bind(this)

        this.wrapperRef = React.createRef()
        this.listRef = React.createRef()
        this.arrowLeftRef = React.createRef()
        this.arrowRightRef = React.createRef()

        this.movieListRefMap = new Map()
        this.hideArrowsTimer = null
        this.isPointerOverArrows = false
        this.state = {
            focusedMovieIndex: 0
        }
    }

    componentDidMount() {
        window.addEventListener('mousemove', this.onMouseMove)
        this.props.hasFocus ? this.setFocus() : this.removeFocus()
        if (this.props.onMount) {
            this.props.onMount(this.props.index, this.wrapperRef)
        }
    }

    componentDidUpdate(prevProps) {
        if (this.wrapperRef.current === null) return
        if (this.props.movies === null) return
        if (this.props.hasFocus === prevProps.hasFocus) return
        this.props.hasFocus ? this.setFocus() : this.removeFocus()
    }

    componentWillUnmount() {
        window.removeEventListener('mousemove', this.onMouseMove)
        clearTimeout(this.hideArrowsTimer)
        this.removeFocus()
    }

    /**
     * Dispatch on user press ok key
     */
    onKeyOk() {
        this.onSelect()
    }

    /**
     * Dispatch on user press left key
     */
    onKeyLeft() {
        this.navigateLeft()
    }

    /**
     * Dispatch on user press right key
     */
    onKeyRight() {
        this.navigateRight()
    }

    /**
     * Dispatch on user click on the left arrow
     */
    onClickArrowLeft() {
        this.navigateLeft()
    }

    /**
     * Dispatch on user click on the right arrow
     */
    onClickArrowRight() {
        this.navigateRight()
    }

    /**
     * Dispatch on user moves the mouse over the
     * MovieItemComponent
     * @param {number} index 
     */
    onMouseEnterMovieItem(index) {
        this.setMovieIndex(index)
        this.onFocus()
    }

    /**
     * Dispatch on user moves the mouse
     */
    onMouseMove() {
        this.showArrows()
    }

    /**
     * Dispatch on user enter the mouse over
     * the arrows
     */
    onMouseEnterArrows() {
        this.isPointerOverArrows = true
    }

    /**
     * Dispatch on user leave the mouse over
     * the arrows
     */    
    onMouseLeaveArrows() {
        this.isPointerOverArrows = false
    }

    /**
     * Set the timer to hide arrows
     */
    setHideArrowsTimer() {
        clearTimeout(this.hideArrowsTimer)
        this.hideArrowsTimer = setTimeout(() => this.hideArrows(), 3000)
    }

    /**
     * Show mouse arrows
     */
    showArrows() {
        this.arrowLeftRef.current.classList.remove(css.arrow__left_hide)
        this.arrowRightRef.current.classList.remove(css.arrow__right_hide)
        this.isPointerOverArrows ? 
            clearTimeout(this.hideArrowsTimer) : this.setHideArrowsTimer()
    }

    /**
     * Hide mouse arrows
     */
    hideArrows() {
        this.arrowLeftRef.current.classList.add(css.arrow__left_hide)
        this.arrowRightRef.current.classList.add(css.arrow__right_hide)
    }

    /**
     * Discover the previous MovieItemComponent and navigate to it
     */
    navigateLeft() {
        const nextIndex = this.getMovieIndex() - 1
        this.setMovieIndex((this.movieListRefMap.has(nextIndex)) ? nextIndex : this.movieListRefMap.size - 1)
        animateList(this.listRef.current, css.slide__right, this.setMovieItemFocus)
    }

    /**
     * Discover the next MovieItemComponent and navigate to it
     */
    navigateRight() {
        const nextIndex = this.getMovieIndex() + 1
        this.setMovieIndex(this.movieListRefMap.has(nextIndex) ? nextIndex : 0)
        animateList(this.listRef.current, css.slide__left, this.setMovieItemFocus)
    }

    /**
     * Dispatch onFocus when user navigate over the
     * MovieItemComponent component
     */
    onFocus() {
        if (this.props.onFocus) {
            setTimeout(() => 
                this.props.onFocus(this.props.movies[this.getMovieIndex()]), 200)
        }
    }

    /**
     * Dispatch onSelect when user trigger the OK key
     */
    onSelect() {
        if (this.props.onSelect) {
            this.props.onSelect()
        }
    }

    /**
     * Set the MovieItemComponent on the Map References
     * when mounted
     * @param {number} index - The MovieItemComponent index
     * @param {React.Ref} ref - The MovieItemComponent Reference
     */
    onMovieItemMount(index, ref) {
        this.movieListRefMap.set(index, ref)
    }

    /**
     * Set focused style class
     */
    setFocus() {
        this.wrapperRef.current.classList.add(css.focused)
        setTimeout(() => this.subscribe(), 0)
        this.onFocus()
    }

    /**
     * Remove the focused style class
     */
    removeFocus() {
        this.wrapperRef.current.classList.remove(css.focused)
        this.unsubscribe()
    }

    /**
     * Set focus on the current MovieItemComponent
     */
    setMovieItemFocus() {
        orderListMap(this.movieListRefMap, this.getMovieIndex())
        this.onFocus()
    }

    /**
     * Get the focusedMovieIndex state var
     * @returns {number} The focusedMovieIndex state var
     */
    getMovieIndex() {
        return this.state.focusedMovieIndex
    }

    /**
     * Set the focusedMovieIndex state var
     * @param {number} focusedMovieIndex - The index of focused
     * Movie.
     */
    setMovieIndex(focusedMovieIndex) {
        this.setState({focusedMovieIndex})
    }

    /**
     * Subscribe the keys to navigate on the MovieListComponent
     */
    subscribe() {
        deviceManager.subscribe(deviceManager.KEY_OK, this.onKeyOk)
        deviceManager.subscribe(deviceManager.KEY_LEFT, this.onKeyLeft)
        deviceManager.subscribe(deviceManager.KEY_RIGHT, this.onKeyRight)
    }

    /**
     * Unsubscribe the keys on the MovieListComponent
     */
    unsubscribe() {
        deviceManager.unsubscribe(deviceManager.KEY_OK)
        deviceManager.unsubscribe(deviceManager.KEY_LEFT)
        deviceManager.unsubscribe(deviceManager.KEY_RIGHT)
    }


    renderMovies() {
        return this.props.movies.map((movie, index) => 
            &lt;MovieItemComponent 
                onMount={this.onMovieItemMount} 
                onMouseEnter={this.onMouseEnterMovieItem}
                key={index} 
                index={index}
                movie={movie}
                hasFocus={this.props.hasFocus &amp;&amp; this.state.focusedMovieIndex === index}
            />
        )
    }

    render() {
        if (this.props.movies === null) return null

        return (
            &lt;div onKeyDown={this.onKeyDown} ref={this.wrapperRef} className={css.wrapper}>
                &lt;h2>{this.props.title}&lt;/h2>
                &lt;ul ref={this.listRef} className={css.movies}>
                    {this.renderMovies()}
                &lt;/ul>
                &lt;div onClick={this.onClickArrowLeft} onMouseEnter={this.onMouseEnterArrows} onMouseLeave={this.onMouseLeaveArrows} ref={this.arrowLeftRef} className={`${css.arrow} ${css.arrow__left} ${css.arrow__left_hide}`}>
                    &lt;i className={css.material__icons}>chevron_left&lt;/i>
                &lt;/div>
                &lt;div onClick={this.onClickArrowRight} onMouseEnter={this.onMouseEnterArrows} onMouseLeave={this.onMouseLeaveArrows} ref={this.arrowRightRef} className={`${css.arrow} ${css.arrow__right} ${css.arrow__right_hide}`}>
                    &lt;i className={css.material__icons}>chevron_right&lt;/i>
                &lt;/div>
            &lt;/div>
        )
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-animateList.html">animateList</a></li><li><a href="module-data.html">data</a></li><li><a href="module-domain.html">domain</a></li><li><a href="module-helpers.html">helpers</a></li><li><a href="module-manager.html">manager</a></li><li><a href="module-orderListMap.html">orderListMap</a></li><li><a href="module-presentation_components.html">presentation/components</a></li><li><a href="module-presentation_routes.html">presentation/routes</a></li><li><a href="module-presentation_viewmodel.html">presentation/viewmodel</a></li></ul><h3>Classes</h3><ul><li><a href="module-data.MoviesService.html">MoviesService</a></li><li><a href="module-domain.MovieEntity.html">MovieEntity</a></li><li><a href="module-domain.MovieInteractor.html">MovieInteractor</a></li><li><a href="module-domain.MoviesInteractor.html">MoviesInteractor</a></li><li><a href="module-manager-DeviceManager.html">DeviceManager</a></li><li><a href="module-presentation_components.MovieItemComponent.html">MovieItemComponent</a></li><li><a href="module-presentation_components.MovieListComponent.html">MovieListComponent</a></li><li><a href="module-presentation_components.SelectedMovieComponent.html">SelectedMovieComponent</a></li><li><a href="module-presentation_components.VideoPlayerComponent.html">VideoPlayerComponent</a></li><li><a href="module-presentation_routes.HomeRouteComponent.html">HomeRouteComponent</a></li><li><a href="module-presentation_routes.MovieRouteComponent.html">MovieRouteComponent</a></li><li><a href="module-presentation_viewmodel.MovieItemViewModel.html">MovieItemViewModel</a></li><li><a href="module-presentation_viewmodel.SelectedMovieViewModel.html">SelectedMovieViewModel</a></li><li><a href="module-presentation_viewmodel.VideoPlayerViewModel.html">VideoPlayerViewModel</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Oct 16 2018 18:26:05 GMT-0300 (Brasilia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
